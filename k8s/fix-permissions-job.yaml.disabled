apiVersion: v1
kind: Namespace
metadata:
  name: tenangdb-privileged
  labels:
    pod-security.kubernetes.io/enforce: privileged
    pod-security.kubernetes.io/audit: privileged
    pod-security.kubernetes.io/warn: privileged
---
apiVersion: batch/v1
kind: Job
metadata:
  name: fix-tenangdb-permissions
  namespace: tenangdb-privileged
spec:
  template:
    spec:
      hostPID: true
      containers:
      - name: fix-permissions
        image: busybox
        command: 
        - sh
        - -c
        - |
          mkdir -p /host/var/lib/tenangdb/backups
          chown -R 1001:1001 /host/var/lib/tenangdb/backups
          chmod -R 775 /host/var/lib/tenangdb/backups
          echo "Permissions fixed"
        securityContext:
          privileged: true
        volumeMounts:
        - name: host-var
          mountPath: /host/var
      volumes:
      - name: host-var
        hostPath:
          path: /var
      restartPolicy: Never
      nodeSelector:
        kubernetes.io/hostname: homelab-k8s-worker-2